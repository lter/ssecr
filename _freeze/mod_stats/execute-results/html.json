{
  "hash": "ead732a26b09fb1940fcbf7bf6884de2",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Analysis & Modeling\"\ncode-annotations: hover\n---\n\n\n## Overview\n\nGiven the wide range in statistical training in graduate curricula (and corresponding breadth of experience among early career researchers), we'll be approaching this module in a different way than the others. One half of the module will use a \"flipped approach\" where project teams will share their proposed analyses with one another. The other half of the module will be dedicated to analyses that are more common in--or exclusive to--synthesis research. Content produced by project teams during the flipped half may be linked in the '[Additional Resources](https://lter.github.io/ssecr/mod_stats.html#additional-resources)' section at the bottom of this module at the discretion of each team. Otherwise the content of this module will focus only on the non-flipped content.\n\n## Learning Objectives\n\nAfter completing this module you will be able to: \n\n- <u>Describe</u> proposed analytical methods to an interested audience of mixed prior experience\n- <u>Explain</u> nuance in interpretation of results of proposed analyses\n- <u>Compare</u> and contrast interpretation of results in synthesis work versus primary research\n- <u>Identify</u> statistical tests common in synthesis research\n- <u>Perform</u> some synthesis-specific analyses\n\n## Needed Packages\n\nIf you'd like to follow along with the code chunks included throughout this module, you'll need to install the following packages:\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Note that these lines only need to be run once per computer\n## So you can skip this step if you've installed these before\ninstall.packages(\"tidyverse\")\ninstall.packages(\"lmerTest\")\n```\n:::\n\n\nWe'll go ahead and load some of these libraries as well to be able to better demonstrate these concepts.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Load needed libraries\nlibrary(tidyverse)\nlibrary(lmerTest)\n```\n:::\n\n\n## Mixed-Effects Models\n\nIn any statistical test there is at least one response variable (a.k.a. \"dependent\" variable) and some number of explanatory variables (a.k.a. \"independent\" variables). However, in biology our experiments often involve repeated sampling over time or at the same locations. These variables (time or site) are neither response nor explanatory variables but we might reasonably conclude that they affect our response and/or explanatory variables.\n\nIn essence we want to use a statistical tool that asks 'what is the effect of the explanatory variable(s) on the response _when the variation due to these non-variable considerations is accounted for_?' Such tests are called **mixed-effects models**. This name derives from considering explanatory variables \"fixed effects\" and non-explanatory/response variables as \"random effects\". Including both fixed and random effects thus creates a model with \"mixed effects.\"\n\n### Types of Random Effect\n\nThere are a few types of random effects but we can limit our conversation here to just two: random intercepts and random slopes.\n\n:::{.panel-tabset}\n#### Random Intercepts\n\nRandom intercepts should be used when you expect that the average response differs among levels of that variable but <u>not</u> in a way that changes the relationship between each level of this variable and the other variables (either fixed or random). In statistical terms you want to allow the intercept to change with levels of this variable.\n\nFor example, let's imagine that we are studying the effect of different organic farming practices on beneficial insect populations. We build relationships with several organic farmers willing to let us conduct this research on their properties and sample the insect communities at each farm over the course of a summer. However, we know that each farm is surrounded by a different habitat type that affects the composition of the local insect community. It is reasonable to expect that even farms where 'the same' management method is used are likely to differ because of this difference in landscape context.\n\nIn cases like this, we don't want to include a term for 'site' as a fixed effect but we do want to account for those differences so that our assessment of the significance of our explanatory variables isn't limited by the variation due to site.\n\n#### Random Slopes\n\nRandom slopes should be used when you expect that the average response differs among levels of that variable in a way that <u>does</u> change with other variables.\n\nFor example, let's imagine that we are studying the effect of temperature on avian malaria rates in songbirds. We identify several sites--along a gradient of daytime temperature ranges--where our species of interest can be found, capture them, and measure malaria infection rates. However, unbeknownst to us at the start of our study, our study sites have varying populations of dragonflies which affects local mosquito populations and malaria transmission/infection rates. If we revisit our sites repeatedly for several years is is reasonable to expect that this difference among sites likely affects the _relationship between_ daytime temperatures and songbird malaria rates.\n\nBy including site as a random slope in this context, we can account for this effect and still analyze our explanatory variables of interest. Note that random slopes are _very_ \"data hungry\" so you may not be able to use them without very high replication in your study design.\n:::\n\n### Nested Random Effects\n\nTo further complicate matters, we can use nested random effects as well. These can be either random intercepts or random slopes though they are more commonly seen with random intercepts. A nested random effect accounts for the effect of one random variable that _is itself affected by another variable!_ A classic example of this is when a study design uses two (or more) levels of spatial nestedness in their experimentall design.\n\nFor instance, let's imagine we were conducting a global study of marine plankton biodiversity. To gether these data we took several cruises (scientific not--exclusively--pleasure) at different places around the world and during each cruise we followed a set of transects. In each transect we did several plankton tows and quantified the diversity of each tow. We can reasonably assume the following:\n\n1. Each cruise differs from each other cruise (due to any number of climatic/ecological factors)\n    - But cruises within the same part of the world are still likely to have similar planktonic communities\n2. Within each cruise, each transect differs from the others (again, due to unpreventable factors)\n    - But transects within the same cruise are still likely to be more similar to one another than to transects in different cruises (even other ones in the same region!)\n3. Within each transect, each plankton tow differs from one another!\n    - But again, more similar to other tows in the same transect than other tows in different transects/cruises\n\nIf we put these assumptions together we realize we want to account for the variation of cruise, transect, and tow <u>while still retaining the nestedness of the similarity among samples</u>. A nested random effect where transect is nested inside of cruise and tow is nested inside of transect would capture this effectively!\n\n### Philosophical Note: Random vs. Fixed\n\nDeciding whether a given variable should be a fixed or random effect can be tough. You'll likely need to rely on your scientific intuition about which feels more appropriate and then be prepared to defend that decision to your committee and/or \"reviewer \\#2\". It may prove helpful though to consider whether you 'care' about the effect of that variable. \n\nIf your hypothesis includes that variable than it should likely be a fixed effect. If the variable is just a facet of your experimental design but isn't something you're necessarily interested in testing, then it should likely be a random effect. And, once you've made your decision, it is totally okay to change your mind and tweak the structure of your model!\n\n:::{.callout-warning icon=\"false\"}\n#### Discussion: Random versus Fixed Effects\n\nWith a small group, decide whether you think the terms in the examples below should be fixed effects or random effects:\n\n- You study small mammal populations in urban settings\n    - Should 'proportion green space' be a fixed effect or a random effect?\n- You are part of a team studying leopard seal feeding behavior\n    - What type of effect should 'observer' be?\n- You study the gut microbiota of a particular beetle species\n    - Should 'beetle sex' be a fixed or a random effect?\n    - What about beetle life stage (e.g., larva versus adult)?\n    - What about the region of the gut from which the samples were taken?\n- You study vascular plant chemical defenses against herbivory\n    - Should phylogeny (i.e., evolutionary relatedness) be a fixed or random effect?\n    - What about feeding guild of the herbivore?\n:::\n\n### Mixed-Effects Case Study\n\nLet's imagine we are researching tarantula populations for several years in the Chihuahuan Desert. Our hypothesis is that the number of tarantulas (response variable) will be greater in sites further from the nearest road (explanatory variable). We select ten study sites of varying distances from the nearest road and intensively count our furry friends for several months at three plots within each site. We return to our sites--and their associated plots--and repeat this process each year for three years. We enter our data and perform careful quality control to get it into a tidy format ready for analyis\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Read in data\ntarantula_df <- read.csv(file = file.path(\"data\", \"tarantulas.csv\"))\n\n# Check structure\nstr(tarantula_df)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n'data.frame':\t450 obs. of  6 variables:\n $ year           : int  2022 2022 2022 2022 2022 2022 2022 2022 2022 2022 ...\n $ road.dist_km   : num  48.3 48.3 48.3 48.3 48.3 ...\n $ site           : chr  \"site_A\" \"site_A\" \"site_A\" \"site_A\" ...\n $ plot           : chr  \"plot_a\" \"plot_a\" \"plot_a\" \"plot_a\" ...\n $ site.plot      : chr  \"A_a\" \"A_a\" \"A_a\" \"A_a\" ...\n $ tarantula_count: int  136 150 145 121 150 107 73 78 83 83 ...\n```\n\n\n:::\n:::\n\n\nOkay, the data look reasonable, but now we want to run some statistical tests and--hopefully--get some endorphine-inducingly small _p_ values. If we choose to simply ignore our possible random effects, we could fit a linear regression.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Fit model\ntarantula_lm <- lm(tarantula_count ~ road.dist_km, data = tarantula_df) # <1>\n\n# Extract summary\nsummary(tarantula_lm)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nCall:\nlm(formula = tarantula_count ~ road.dist_km, data = tarantula_df)\n\nResiduals:\n     Min       1Q   Median       3Q      Max \n-134.608  -47.286    4.002   39.485  189.392 \n\nCoefficients:\n             Estimate Std. Error t value Pr(>|t|)    \n(Intercept)    0.6664     9.0072   0.074    0.941    \nroad.dist_km   2.1936     0.1980  11.078   <2e-16 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 65.26 on 448 degrees of freedom\nMultiple R-squared:  0.215,\tAdjusted R-squared:  0.2133 \nF-statistic: 122.7 on 1 and 448 DF,  p-value: < 2.2e-16\n```\n\n\n:::\n:::\n\n1. R syntax for statistical tests is `response ~ explanatory` a.k.a. `Y ~ X`\n\nLooks like our hypothesis is supported! There does seem to be an effect of human proximity on tarantula populations in our study sites. However, while running this regression we remembered that in the second year of the study a new graduate student joined our lab and helped us in the field. In the first and third years we worked alone (the new graduate student had their own project to work on in the third year of this work).\n\nThere is an argument for including year as a fixed effect in its own right but some back-of-the-envelope checks reveal no significant climatic differences across the region we worked among those three years. So, while we think that years may differ from one another, that difference is not something we care to analyze.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Fit the new model\ntarantula_mem1 <- lmerTest::lmer(tarantula_count ~ road.dist_km + \n                               (1|year), # <1>\n                             data = tarantula_df)\n\n# Extract summary\nsummary(tarantula_mem1)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nLinear mixed model fit by REML. t-tests use Satterthwaite's method [\nlmerModLmerTest]\nFormula: tarantula_count ~ road.dist_km + (1 | year)\n   Data: tarantula_df\n\nREML criterion at convergence: 4999.4\n\nScaled residuals: \n    Min      1Q  Median      3Q     Max \n-2.2853 -0.8263  0.1245  0.6357  2.6641 \n\nRandom effects:\n Groups   Name        Variance Std.Dev.\n year     (Intercept)  540.1   23.24   \n Residual             3897.7   62.43   \nNumber of obs: 450, groups:  year, 3\n\nFixed effects:\n             Estimate Std. Error       df t value Pr(>|t|)    \n(Intercept)    0.6664    15.9462   3.6297   0.042    0.969    \nroad.dist_km   2.1936     0.1894 446.0000  11.580   <2e-16 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nCorrelation of Fixed Effects:\n            (Intr)\nroad.dst_km -0.508\n```\n\n\n:::\n:::\n\n1. This is the syntax for specifying a random intercept (as opposed to the other types of random effect discussed above)\n\nStill significant but while writing that test we realized there's another non-variable that should probably be made into a random effect: plot! There were three sites within each plot and from our extensive time in the field we have developed a strong intuition that there might be substantial among-plot variation at each site. We can make a quick exploratory graph to facilitate an 'eyeball test' of whether the data show what our intuition suggest.\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nggplot(tarantula_df, aes(y = tarantula_count, x = plot, fill = plot)) +\n  geom_violin(alpha = 0.5) + # <1>\n  geom_jitter(width = 0.25, size = 0.5) +\n  facet_wrap(site ~ .) +\n  theme_bw() +\n  theme(axis.text.x = element_text(angle = 35, hjust = 1)) # <2>\n```\n\n::: {.cell-output-display}\n![](mod_stats_files/figure-html/mem-explore-graph-1.png){fig-align='center' width=672}\n:::\n:::\n\n1. Violin plots are a nice alternative to boxplots because they allow visualizing data distributions directly rather than requiring an intutive grasp of the distribution metrics described by each bit of a boxplot\n2. This is allowing us to 'tilt' the X axis tick labels so they don't overlap with one another\n\nThis plot clearly supports our intuition that among-plot variation is dramatic! We _could_ account for this by including plot as a fixed effect but we'll need to sacrifice a lot of degrees of freedom (think 'statistical power') for a variable that we don't actually care about! Instead, we could include plot as a random effect.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Fit the new model\ntarantula_mem2 <- lmerTest::lmer(tarantula_count ~ road.dist_km + \n                               (1|year) + (1|site.plot), # <1>\n                             data = tarantula_df)\n\n# Extract summary\nsummary(tarantula_mem2)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nLinear mixed model fit by REML. t-tests use Satterthwaite's method [\nlmerModLmerTest]\nFormula: tarantula_count ~ road.dist_km + (1 | year) + (1 | site.plot)\n   Data: tarantula_df\n\nREML criterion at convergence: 4079.5\n\nScaled residuals: \n    Min      1Q  Median      3Q     Max \n-2.8688 -0.5245 -0.0289  0.6262  3.5882 \n\nRandom effects:\n Groups    Name        Variance Std.Dev.\n site.plot (Intercept) 3755.9   61.29   \n year      (Intercept)  563.7   23.74   \n Residual               360.7   18.99   \nNumber of obs: 450, groups:  site.plot, 30; year, 3\n\nFixed effects:\n             Estimate Std. Error      df t value Pr(>|t|)   \n(Intercept)    0.6664    35.6070 27.0358   0.019  0.98521   \nroad.dist_km   2.1936     0.7225 28.0003   3.036  0.00513 **\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nCorrelation of Fixed Effects:\n            (Intr)\nroad.dst_km -0.867\n```\n\n\n:::\n:::\n\n1. Note that we need to use this column as the random effect because <u>plots are not uniquely named across sites</u> (i.e., all sites have plots \"a\", \"b\", and \"c\"). Making the random effect just the 'plot' column would fail to reflect how plots are nested within each site\n\nLooks like there is still a significant effect of road distance on tarantula populations but it is weaker than when we don't account for variation among plots (T values of ~11 versus ~3). Still, this is a result we can be more confident in because we've now accounted for all known sources of variation in our data--either by including them as fixed effects or including them as a random effects.\n\n## Multi-Model Inference\n\n\n\n## Meta-Analysis\n\n\n\n## Additional Resources\n\n### Papers & Documents\n\n- [Understanding ‘It Depends’ in Ecology: A Guide to Hypothesising, Visualising and Interpreting Statistical Interactions](https://onlinelibrary.wiley.com/doi/10.1111/brv.12939). Spake _et al._, 2023. **Biological Reviews** \n- [Improving Quantitative Synthesis to Achieve Generality in Ecology](https://www.nature.com/articles/s41559-022-01891-z). Spake _et al._, 2022.**Nature Ecology and Evolution**\n- [Doing Meta-Analysis with R: A Hands-On Guide](https://bookdown.org/MathiasHarrer/Doing_Meta_Analysis_in_R/). Harrier _et al._ 2023.\n- [Mixed Effects Models and Extensions in Ecology with R](https://link.springer.com/book/10.1007/978-0-387-87458-6). Zuur _et al._, 2009.\n\n### Workshops & Courses\n\n- Matt Vuorre's [Bayesian Meta-Analysis with R, Stan, and brms](https://mvuorre.github.io/posts/2016-09-29-bayesian-meta-analysis/)\n\n### Websites\n\n- \n",
    "supporting": [
      "mod_stats_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}