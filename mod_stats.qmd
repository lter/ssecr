---
title: "Analysis & Modeling"
code-annotations: hover
---

## Overview

Given the wide range in statistical training in graduate curricula (and corresponding breadth of experience among early career researchers), we'll be approaching this module in a different way than the others. One half of the module will use a "flipped approach" where project teams will share their proposed analyses with one another. The other half of the module will be dedicated to analyses that are more common in--or exclusive to--synthesis research. Content produced by project teams during the flipped half may be linked in the [Additional Resources](https://lter.github.io/ssecr/mod_stats.html#additional-resources) section at the bottom of this module at the discretion of each team. Otherwise the content of this module will focus only on the non-flipped content.

## Learning Objectives

After completing this module you will be able to: 

- <u>Describe</u> proposed analytical methods to an interested audience of mixed prior experience
- <u>Explain</u> nuance in interpretation of results of proposed analyses
- <u>Compare</u> and contrast interpretation of results in synthesis work versus primary research
- <u>Identify</u> statistical tests common in synthesis research
- <u>Perform</u> some synthesis-specific analyses

## Needed Packages

If you'd like to follow along with the code chunks included throughout this module, you'll need to install the following packages:

```{r install-pkgs}
#| eval: false

# Note that these lines only need to be run once per computer
## So you can skip this step if you've installed these before
install.packages("tidyverse")
install.packages("lmerTest")
```

We'll go ahead and load some of these libraries as well to be able to better demonstrate these concepts.

```{r libs}
#| message: false

# Load needed libraries
library(tidyverse)
library(lmerTest)
```

## Mixed-Effects Models

In any statistical test there is at least one response variable (a.k.a. "dependent" variable) and some number of explanatory variables (a.k.a. "independent" variables). However, in biology our experiments often involve repeated sampling over time or at the same locations in order to gather enough replicates to do robust analysis. These variables are neither response nor explanatory variables but we might reasonably conclude that they affect our response and/or explanatory variables.

In essence we want to use a statistical tool that asks <u>what is the effect of the explanatory variable(s) on the response _when the variation due to these non-variable considerations are accounted for_</u>?' Such tests are called "mixed-effects models." This name derives from considering explanatory variables "fixed effects" and these non-explanatory/response variables as "random effects". Including both fixed and random effects thus creates a model with "mixed effects."

### Random Intercepts



### Random Slopes



### Philosophical Note: Random vs. Fixed



### Mixed-Effects Case Study

Let's imagine we are researching tarantula populations for several years in the Chihuahuan Desert. Our hypothesis is that the number of tarantulas (response variable) will be greater in sites further from the nearest road (explanatory variable). We select ten study sites of varying distances from the nearest road and intensively count our furry friends for several months at three plots within each site. We return to our sites--and their associated plots--and repeat this process each year for three years. We enter our data and perform careful quality control to get it into a tidy format ready for analyis

```{r mem-data}
# Read in data
tarantula_df <- read.csv(file = file.path("data", "tarantulas.csv"))

# Check structure
str(tarantula_df)
```

Okay, the data look reasonable, but now we want to run some statistical tests and--hopefully--get some endorphine-inducingly small _p_ values. If we choose to simply ignore our possible random effects, we could fit a linear regression.

```{r mem-lm}
# Fit model
tarantula_lm <- lm(tarantula_count ~ road.dist_km, data = tarantula_df) # <1>

# Extract summary
summary(tarantula_lm)
```
1. R syntax for statistical tests is `response ~ explanatory` a.k.a. `Y ~ X`

Looks like our hypothesis is supported! There does seem to be an effect of human proximity on tarantula populations in our study sites. However, while running this regression we remembered that in the second year of the study a new graduate student joined our lab and helped us in the field. In the first and third years we worked alone (the new graduate student had their own project to work on in the third year of this work).

There is an argument for including year as a fixed effect in its own right but some back-of-the-envelope checks reveal no significant climatic differences across the region we worked among those three years. So, while we think that years may differ from one another, that difference is not something we care to analyze.

```{r mem-mix1}
# Fit the new model
tarantula_mem1 <- lmerTest::lmer(tarantula_count ~ road.dist_km + 
                               (1|year), # <1>
                             data = tarantula_df)

# Extract summary
summary(tarantula_mem1)
```
1. This is the syntax for specifying a random intercept (as opposed to the other types of random effect discussed above)

Still significant but while writing that test we realized there's another non-variable that should probably be made into a random effect: plot! There were three sites within each plot and from our extensive time in the field we have developed a strong intuition that there might be substantial among-plot variation at each site. We can make a quick exploratory graph to facilitate an 'eyeball test' of whether the data show what our intuition suggest.

```{r mem-explore-graph}
#| fig-align: center
#| fig-width: 7
#| fig-height: 6
ggplot(tarantula_df, aes(y = tarantula_count, x = plot, fill = plot)) +
  geom_violin(alpha = 0.5) + # <1>
  geom_jitter(width = 0.25, size = 0.5) +
  facet_wrap(site ~ .) +
  theme_bw() +
  theme(axis.text.x = element_text(angle = 35, hjust = 1)) # <2>
```
1. Violin plots are a nice alternative to boxplots because they allow visualizing data distributions directly rather than requiring an intutive grasp of the distribution metrics described by each bit of a boxplot
2. This is allowing us to 'tilt' the X axis tick labels so they don't overlap with one another

This plot clearly supports our intuition that among-plot variation is dramatic! We _could_ account for this by including plot as a fixed effect but we'll need to sacrifice a lot of degrees of freedom (think 'statistical power') for a variable that we don't actually care about! Instead, we could include plot as a random effect.

```{r mem-mix2}
# Fit the new model
tarantula_mem2 <- lmerTest::lmer(tarantula_count ~ road.dist_km + 
                               (1|year) + (1|site.plot), # <1>
                             data = tarantula_df)

# Extract summary
summary(tarantula_mem2)
```
1. Note that we need to use this column as the random effect because <u>plots are not uniquely named across sites</u> (i.e., all sites have plots "a", "b", and "c"). Making the random effect just the 'plot' column would fail to reflect how plots are nested within each site

Looks like there is still a significant effect of road distance on tarantula populations but it is weaker than when we don't account for variation among plots (T values of ~11 versus ~3). Still, this is a result we can be more confident in because we've now accounted for all known sources of variation in our data--either by including them as fixed effects or including them as a random effects.

## Multi-Model Inference



## Meta-Analysis



## Additional Resources

### Papers & Documents

- [Understanding ‘It Depends’ in Ecology: A Guide to Hypothesising, Visualising and Interpreting Statistical Interactions](https://onlinelibrary.wiley.com/doi/10.1111/brv.12939). Spake _et al._, 2023. **Biological Reviews** 
- [Improving Quantitative Synthesis to Achieve Generality in Ecology](https://www.nature.com/articles/s41559-022-01891-z). Spake _et al._, 2022.**Nature Ecology and Evolution**
- [Doing Meta-Analysis with R: A Hands-On Guide](https://bookdown.org/MathiasHarrer/Doing_Meta_Analysis_in_R/). Harrier _et al._ 2023.
- [Mixed Effects Models and Extensions in Ecology with R](https://link.springer.com/book/10.1007/978-0-387-87458-6). Zuur _et al._, 2009.

### Workshops & Courses

- Matt Vuorre's [Bayesian Meta-Analysis with R, Stan, and brms](https://mvuorre.github.io/posts/2016-09-29-bayesian-meta-analysis/)

### Websites

- 
